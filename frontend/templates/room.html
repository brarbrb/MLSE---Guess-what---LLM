{% extends "base.html" %}

{% block styles %}
  {{ super() }}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/room.css') }}">
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script>
    window.currentUser = {{ {"username": session.get("username","")} | tojson }};
    try { localStorage.setItem('currentUser', JSON.stringify(window.currentUser)); } catch(e) {}
  </script>
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js" defer></script>
  <script src="{{ url_for('static', filename='js/room.js') }}" defer></script>
{% endblock %}

{% block content %}
  <div class="room-wrap">
    <!-- Left: round content -->
    <section class="room-left">
      <header class="round-header">
      <h2 id="round-title" class="round-title">Round 1</h2>
      <div class="round-meta">
        <span id="round-status" class="badge">waiting</span>
        <span id="round-timer" class="timer" hidden>00:00</span>
      </div>
        <script>
  document.addEventListener('DOMContentLoaded', () => {
    const a = document.querySelector('a[href="/logout"]');
    if (a) {
      a.textContent = "Exit the game";
      a.setAttribute('href', '/menu');
      // optional: style tweak
      a.classList.add('btn', 'btn-secondary');
    }
  });
</script>
      </header>

      <div class="round-body">
        <h3 class="desc-label">Description</h3>
        <p id="round-description" class="desc-text">—</p>
      </div>

      <ul id="players-list" class="players">
        <!-- filled by JS -->
      </ul>
    </section>

    <!-- Right: chat -->
    <aside class="room-right">
      <h3 class="chat-title">Chat</h3>
      <div id="chat-list" class="chat-list"></div>
      <form id="chat-form" class="chat-form" autocomplete="off">
        <input id="chat-input" placeholder="Type your guess…" />
        <button type="submit" class="btn">Send</button>
      </form>
    </aside>
  </div>

  <!-- MODALS -->
  <div id="modal-overlay" class="modal-overlay" hidden></div>

  <!-- Creator: describe -->
<!-- Creator: describe -->
<div id="modal-describer" class="modal" hidden>
  <!-- LOADING: shown while AI generates target + forbidden -->
  <div id="describer-loading">
    <h3>Setting up the round…</h3>
    <p class="muted">Please wait while the AI generates a target word and forbidden words.</p>
    <div class="spinner" aria-label="Loading"></div>
  </div>

  <!-- READY: shown after AI returns target/forbidden -->
  <div id="describer-ready" hidden>
    <h3>Your word</h3>
    <div class="word-card">
      <div><b>Target:</b> <span id="modal-target">—</span></div>
      <div><b>Forbidden:</b>
        <ul id="modal-forbidden"></ul>
      </div>
    </div>
    <form id="describer-form" class="modal-form" autocomplete="off">
      <label>Type your description</label>
      <textarea id="description-input" rows="3" placeholder="Write a clear clue without forbidden words…"></textarea>
      <div class="modal-actions">
        <button type="submit" class="btn primary">Send description</button>
      </div>
    </form>
    <p id="desc-error" class="error" hidden></p>
  </div>

  <!-- VERIFYING: shown right after describer submits -->
  <div id="describer-verifying" hidden>
    <h3>Verifying your description…</h3>
    <p class="muted">Don’t close this window.</p>
    <div class="spinner" aria-label="Loading"></div>
  </div>
</div>

<!-- Players: waiting / reveal -->
<div id="modal-waiting" class="modal" hidden>
  <h3 id="waiting-title">Waiting for description…</h3>
  <p id="waiting-text" class="muted">The describer is preparing a clue.</p>
  <div class="spinner" aria-label="Loading"></div>
</div>


    <!-- Winner -->
    <div id="modal-winner" class="modal" hidden>
      <h3>Round finished!</h3>
      <p><b id="winner-name">Someone</b> guessed the word <b id="winner-word">???</b>.</p>
      <p class="muted" id="winner-time"></p>

      <!-- existing final results container is fine -->
      <div id="winner-final-results" hidden></div>
      <p id="between-rounds-countdown" class="muted" hidden>The next round will start in 10s</p>

      <div class="modal-actions">
        <button id="btn-see-game" class="btn">See the game</button>
        <a href="/menu" class="btn danger">Exit to menu</a>
      </div>
    </div>
  <!-- Review navigation (only visible in ?review=1) -->
<div id="review-nav" class="review-nav" hidden>
  <button id="review-prev" class="btn">&larr; Previous round</button>
  <button id="review-next" class="btn" style="float:right">Next round &rarr;</button>
</div>

{% endblock %}
